<?php

/**
 * @var $this       \Application\View\Renderer\PhpRenderer
 * @var $privileges UnicaenAuth\Entity\Db\Privilege[]
 * @var $roles      Application\Entity\Db\Role[]
 */

?>
<h1 class="page-header">Gestion des privilèges</h1>
<table class="droits-tbl table table-bordered table-sm table-header-rotated">
    <thead>
    <tr>
        <th class="menu"></th>
        <?php foreach ($roles as $role): ?>
            <th class="rotate-45 role" data-role="<?= $role->getId() ?>">
                <div title="<?= $role; ?>"><span><a><?= $role; ?></a></span></div>
            </th>
        <?php endforeach; ?>
    </tr>
    </thead>
    <tbody>
    <tr>
        <th class="categorie" colspan="<?= 2 + count($roles); ?>">
            <select class="categorie selectpicker" data-live-search="true" data-width="auto">
                <option value="">Veuillez choisir une catégorie de privilèges ...</option>
                <?php foreach ($privileges as $cat): ?>
                    <option value="<?= $cat['categorie']->getCode() ?>"><?= $cat['categorie'] ?></option>
                <?php endforeach; ?>
            </select>
        </th>
    </tr>
    <?php foreach ($privileges as $cat): ?>
        <?php foreach ($cat['privileges'] as $privilege): ?>
            <tr class="categorie" data-categorie="<?= $cat['categorie']->getCode() ?>" style="display: none">
                <th class="privilege"><?= $privilege ?></th>
                <?php
                foreach ($roles as $role): ?>
                    <td class="modifier role" data-role="<?= $role->getId() ?>" data-privilege="<?= $privilege->getId() ?>">
                        <?= $this->partial('/application/droits/partial/tbl-link', compact('role', 'privilege')) ?>
                    </td>
                <?php endforeach; ?>

            </tr>
        <?php endforeach; ?>
    <?php endforeach; ?>
    </tbody>
</table>