<style>
    div.modal-dialog { width: 50%; }
</style>

<ul>
<?php foreach ($this->indicateurImpl->getResult() as $i => $r): ?>
    <?php $resultId = $this->indicateurImpl->getResultItemIdExtractor()->filter($r); ?>
    <li class="intervenant" data-id="<?php echo $resultId ?>">
        <a href="<?php echo $this->indicateurImpl->getResultItemUrl($r) ?>"
           title="Cliquez pour vous rendre à la page concernée"
           ><?php echo $this->indicateurImpl->getResultItemFormatter()->filter($r) ?></a>
    </li>
<?php endforeach; ?>
</ul>

<?php if ($this->displaySendMailLink && $this->indicateurImpl->getResult()): ?>
<p>
    <?php $url = $this->url('notification/indicateur-intervenants', ['indicateur' => $this->indicateurImpl->getIndicateurEntity()->getId()]); ?>
    <a id="send-mail-link"
       class="ajax-modal btn btn-primary"
       data-event="event-send-mail"
       href="<?php echo $url ?>">Rédiger un mail pour les intervenants sélectionnés...</a>
</p>
<?php endif; ?>


<script>
    $(function() {
        var sendMailLink = $("#send-mail-link");
        var sendMailUrlToken = "__intervenantsIds__";
        var sendMailUrlPattern = sendMailLink.attr("href") + "?" + sendMailUrlToken;
        var checkboxes = installCheckboxes($("li.intervenant"), 'intervenant', true); /* Cf. public/js/util.js */

        checkboxes
            .change(function() {console.log(checkboxes.filter(":checked").length);
                sendMailLink.prop("href", sendMailUrlPattern.replace(sendMailUrlToken, checkboxes.serialize()));
                sendMailLink.attr("disabled", checkboxes.filter(":checked").length <= 0);
            })
            .change();
    });
</script>