<?php


use Application\Provider\Privilege\Privileges;
use ExportRh\Assertion\ExportRhAssertion;

/* @var $intervenant \Application\Entity\Db\Intervenant */
/* @var $tab string */

$this->intervenant($intervenant)->renderTitle('Fiche');

//
//$tabs = [
//    [
//        'id'            => 'fiche',
//        'label'         => '<i class="fas fa-eye"></i> Fiche',
//        'content'       => $this->partial('application/intervenant/fiche.phtml', compact('intervenant')),
//        'url'           => $this->url('intervenant/fiche', ['intervenant' => $intervenant->getId()]),
//        'force-refresh' => true,
//    ],
//];
//
//    $tabs[] = [
//        'id'    => 'edition',
//        'label' => '<i class="fas fa-pencil"></i> Édition',
//        'url'   => $this->url('intervenant/saisir', ['intervenant' => $intervenant->getId()]),
//    ];
//}
//
//if ($this->isAllowed(Privileges::getResourceId(Privileges::INTERVENANT_EDITION))) {
//    $tabs[] = [
//        'id'            => 'synchronisation',
//        'label'         => '<i class="fas fa-download"></i> Synchronisation',
//        'url'           => $this->url('intervenant/synchronisation', ['intervenant' => $intervenant->getId()]),
//        'force-refresh' => true,
//    ];
//}
//
//if ($this->isAllowed($intervenant, \ExportRh\Assertion\ExportRhAssertion::PRIV_CAN_INTERVENANT_EXPORT_RH)) {
//    $tabs[] = [
//        'id'            => 'export-rh',
//        'label'         => '<i class="fas fa-upload"></i> Export RH',
//        'url'           => $this->url('intervenant/exporter', ['intervenant' => $intervenant->getId()]),
//        'force-refresh' => true,
//    ];
//}
//
//
//if ($this->isAllowed(Privileges::getResourceId(Privileges::INTERVENANT_SUPPRESSION))) {
//    $tabs[] = [
//        'id'            => 'suppression',
//        'label'         => '<i class="fas fa-trash-can"></i> Suppression',
//        'url'           => $this->url('intervenant/supprimer', ['intervenant' => $intervenant->getId()]),
//        'force-refresh' => true,
//    ];
//}
//
//
//if ($this->isAllowed(Privileges::getResourceId(Privileges::PLAFONDS_DEROGATIONS_VISUALISATION))) {
//    $tabs[] = [
//        'id'            => 'derogations',
//        'label'         => '<i class="fas fa-shuffle"></i> Dérogations',
//        'url'           => $this->url('derogations', ['intervenant' => $intervenant->getId()]),
//        'force-refresh' => true,
//    ];
//}
//
//if ($this->isAllowed(Privileges::getResourceId(Privileges::INTERVENANT_NOTE_VISUALISATION))) {
//    $label = '<span class="glyphicon glyphicon-book"></span> Notes';
//    if ($notificationNote > 0) {
//        $label .= ' <span class="badge" style="background-color: #fc1010;font-size:10px;margin-bottom:5px;">' . $notificationNote . '</span>';
//    }
//    $tabs[] = [
//        'id'            => 'notes',
//        'label'         => $label,
//        'url'           => $this->url('note', ['intervenant' => $intervenant->getId()]),
//        'force-refresh' => true,
//    ];
//}

//echo $this->tabajax($tabs, $tab);?>
<ul class="nav onglet nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" href="#fiche" aria-controls="fiche" role="tab" data-bs-toggle="tab">
            Fiche
        </a>
    </li>
    <?php if ($this->isAllowed(Privileges::getResourceId(Privileges::INTERVENANT_EDITION))) : ?>
    <li class="nav-item">
        <a class="nav-link" href="#edition" aria-controls="edition" role="tab" data-bs-toggle="tab">
            Edition
        </a>
    </li>
    <?php endif; ?>
    <?php if ($this->isAllowed(Privileges::getResourceId(Privileges::INTERVENANT_EDITION))) : ?>
    <li class="nav-item">
        <a class="nav-link" href="#synchronisation" aria-controls="synchronisation" role="tab" data-bs-toggle="tab">
            Synchronisation
        </a>
    </li>
    <?php endif; ?>
    <?php if ($this->isAllowed($intervenant, ExportRhAssertion::PRIV_CAN_INTERVENANT_EXPORT_RH)) : ?>
    <li class="nav-item">
        <a class="nav-link" href="#exportRH" aria-controls="exportRH" role="tab" data-bs-toggle="tab">
            export RH
        </a>
    </li>
    <?php endif; ?>
</ul>
<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="fiche" role="tabpanel" aria-labelledby="fiche-tab">
        <?php echo $this->partial('fiche', ['intervenant' => $intervenant]); ?>
    </div>
    <div class="tab-pane fade show" id="edition" role="tabpanel" aria-labelledby="edition-tab"
         data-url="<?= $this->url('intervenant/saisir', ['intervenant' => $intervenant->getId()]); ?>">
    </div>
    <div class="tab-pane fade show" id="synchronisation" role="tabpanel" aria-labelledby="synchronisation-tab"
         data-url="<?= $this->url('intervenant/synchronisation', ['intervenant' => $intervenant->getId()]); ?>">
    </div>
    <div class="tab-pane fade show" id="exportRH" role="tabpanel" aria-labelledby="exportRH-tab"
         data-url="<?= $this->url('intervenant/exporter', ['intervenant' => $intervenant->getId()]); ?>">
    </div>
</div>
<script>
    //Rechargement de la page sur event
    $(function () {
        $("#edition").refresh();
        $("#synchronisation").refresh();
    });

    $(function () {
        let hash = $(location).attr('hash');
        let name = hash.substr(1);
        if (name === undefined || name === "") name = "edition";

        $('a[aria-controls=' + name + ']').tab('active');

        $('ul.onglet.nav a').click(function (e) {
            let anchor = $(this).attr('aria-controls');
            e.preventDefault(); // >> bloque le scrolling, mais aussi la ré-écriture de l'url "#info" ...
            history.replaceState(null, null, "#" + anchor);
            $(this).tab('show');
        });
    });
</script>