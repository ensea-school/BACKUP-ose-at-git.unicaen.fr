<?php
/* @var $this Application\View\Renderer\PhpRenderer */
/* @var $role \Application\Acl\Role */

$this->headTitle("Accueil");
echo $this->messenger()->addMessagesFromFlashMessenger();

?>
    <div class="jumbotron">
        <h1><span class="appname"><span class="c1">O</span><span class="c2">S</span><span class="c3">E</span></span>
            <small>Organisation des Services d'Enseignement</small>
        </h1>
        <p class="lead">Bienvenue dans l'application de saisie des enseignements de l'université de Caen Normandie.</p>
        <p class="lead">Année <?php echo $annee ?>.</p>

        <?php
        if ($role){

            if ($intervenant = $role->getIntervenant()){
                if ($intervenant->getStatut()->getNonAutorise()){

                    ?><p><div class='alert alert-danger'> Votre statut ne vous permet pas de vous connecter à OSE.</div></p><?php

                }else{
                    echo $this->feuillederoute($intervenant)->renderCurrentBtn();
                }

            }elseif ($role->getStructure()) {

                $url   = $this->url('service/resume');
                $label = $this->translate("Tableau synthétique des enseignements concernant ma composante...");
                ?><p><a class="btn btn-primary btn-large" href="<?php echo $url ?>"><?php echo $label ?></a></p><?php

            }elseif (!$role->getPersonnel()){
            ?>
            <div class="alert alert-danger" role="alert">
                Vous n'êtes pas autorisé(e) à vous connecter à OSE avec ce compte. Nous vous prions de vous rapprocher de votre composante pour en obtenir un valide.
            </div>
            <?php
            }

        }else{

            ?><a class="btn btn-success btn-large" href="<?php echo $this->url('zfcuser/login') ?>"><?php echo $this->translate('Connectez-vous...') ?></a><?php

        }
        ?>
    </div>

    <!-------------------------- Indicateurs (AJAX) -------------------------->
<?php if (isset($this->abonnementsUrl)): ?>
    <script>
        $(function ()
        {
            var url = '<?php echo $this->abonnementsUrl ?>';
            $(".abonnements").hide();
            $("#abonnements").load(url, [], function ()
            {
                $(".abonnements").fadeIn();
                $(this).hide().fadeIn();
            });
        });
    </script>
    <h2 class="abonnements">Vos indicateurs <a class="btn btn-default btn-sm pull-right"
                                               href="<?php echo $this->url('indicateur') ?>">Gérer vos abonnements à des
            indicateurs</a></h2>
    <div id="abonnements">
        <div class="loading"></div>
    </div>
<?php endif ?>

    <!----------------------------- Feuille de route --------------------------->
<?php
if ($role && $intervenant = $role->getIntervenant()){
    echo $this->feuillederoute($intervenant);
}
