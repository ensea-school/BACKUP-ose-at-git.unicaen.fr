SELECT
	COALESCE(HEURE_DOT.ANNEE_ID,HEURE_LIQUID.ANNEE_ID) ANNEE_ID,
	COALESCE(HEURE_DOT.TYPE_RESSOURCE_ID, HEURE_LIQUID.TYPE_RESSOURCE_ID) TYPE_RESSOURCE_ID,
	COALESCE(HEURE_DOT.STRUCTURE_ID, HEURE_LIQUID.STRUCTURE_ID) STRUCTURE_ID,
	SUM(HEURE_DOT.HEURES) HEURES_D,
	SUM(HEURE_LIQUID.HEURES) HEURES_L
FROM
	(
		SELECT
			DOTATION.ANNEE_ID,
			DOTATION.TYPE_RESSOURCE_ID,
			DOTATION.STRUCTURE_ID,
			SUM(
				CASE
					WHEN DOTATION.HISTO_DESTRUCTION IS NULL THEN DOTATION.HEURES
					ELSE 0.0
				END
			) HEURES
		FROM
			DOTATION
		GROUP BY
			DOTATION.ANNEE_ID,
			DOTATION.TYPE_RESSOURCE_ID,
			DOTATION.STRUCTURE_ID
	) HEURE_DOT
	FULL OUTER JOIN (
		SELECT
			V_TBL_DMEP_LIQUIDATION.ANNEE_ID,
			V_TBL_DMEP_LIQUIDATION.TYPE_RESSOURCE_ID,
			V_TBL_DMEP_LIQUIDATION.STRUCTURE_ID,
			SUM(V_TBL_DMEP_LIQUIDATION.HEURES) HEURES
		FROM
			V_TBL_DMEP_LIQUIDATION
		GROUP BY
			V_TBL_DMEP_LIQUIDATION.ANNEE_ID,
			V_TBL_DMEP_LIQUIDATION.TYPE_RESSOURCE_ID,
			V_TBL_DMEP_LIQUIDATION.STRUCTURE_ID
	) HEURE_LIQUID
		ON HEURE_DOT.ANNEE_ID = HEURE_LIQUID.ANNEE_ID
		AND HEURE_DOT.TYPE_RESSOURCE_ID = HEURE_LIQUID.TYPE_RESSOURCE_ID
		AND HEURE_DOT.STRUCTURE_ID = HEURE_LIQUID.STRUCTURE_ID
GROUP BY
	COALESCE(HEURE_DOT.ANNEE_ID,HEURE_LIQUID.ANNEE_ID),
	COALESCE(HEURE_DOT.TYPE_RESSOURCE_ID, HEURE_LIQUID.TYPE_RESSOURCE_ID),
	COALESCE(HEURE_DOT.STRUCTURE_ID, HEURE_LIQUID.STRUCTURE_ID)