CREATE OR REPLACE TRIGGER T_CLO_INTERVENANT
AFTER INSERT 
OR UPDATE OF 
  annee_id,
	statut_id,
	histo_creation,
	histo_destruction
OR DELETE ON INTERVENANT
FOR EACH ROW
BEGIN

  IF :NEW.id IS NOT NULL THEN
    OSE_EVENT.DEMANDE_CALCUL( OSE_CLOTURE_REALISE.package_sujet, :NEW.id );
  END IF;
  
  IF :OLD.id IS NOT NULL THEN
    OSE_EVENT.DEMANDE_CALCUL( OSE_CLOTURE_REALISE.package_sujet, :OLD.id );
  END IF;

END;

/

CREATE OR REPLACE TRIGGER T_CLO_STATUT_INTERVENANT
AFTER INSERT 
OR UPDATE OF 
    peut_cloturer_saisie
OR DELETE ON STATUT_INTERVENANT
FOR EACH ROW
BEGIN

  FOR p IN (
  
    SELECT DISTINCT
      i.id intervenant_id
    FROM
      intervenant i
    WHERE
         i.statut_id = :NEW.id
      OR i.statut_id = :OLD.id
  
  ) LOOP
  
    OSE_EVENT.DEMANDE_CALCUL( OSE_CLOTURE_REALISE.package_sujet, p.intervenant_id );
  
  END LOOP;

END;

/

CREATE OR REPLACE TRIGGER T_CLO_VALIDATION
AFTER INSERT 
OR UPDATE OF 
    intervenant_id,
    type_validation_id,
    histo_creation,
    histo_destruction
OR DELETE ON VALIDATION
FOR EACH ROW
BEGIN

  IF :NEW.intervenant_id IS NOT NULL THEN
    OSE_EVENT.DEMANDE_CALCUL( OSE_CLOTURE_REALISE.package_sujet, :NEW.intervenant_id );
  END IF;
  
  IF :OLD.intervenant_id IS NOT NULL THEN
    OSE_EVENT.DEMANDE_CALCUL( OSE_CLOTURE_REALISE.package_sujet, :OLD.intervenant_id );
  END IF;

END;

/







CREATE OR REPLACE TRIGGER T_CLO_INTERVENANT_S
AFTER INSERT OR UPDATE OR DELETE ON INTERVENANT
BEGIN
  OSE_EVENT.CALCULER_DEMANDES;
END;

/

CREATE OR REPLACE TRIGGER T_CLO_STATUT_INTERVENANT_S
AFTER INSERT OR UPDATE OR DELETE ON STATUT_INTERVENANT
BEGIN
  OSE_EVENT.CALCULER_DEMANDES;
END;

/

CREATE OR REPLACE TRIGGER T_CLO_VALIDATION_S
AFTER INSERT OR UPDATE OR DELETE ON VALIDATION
BEGIN
  OSE_EVENT.CALCULER_DEMANDES;
END;
