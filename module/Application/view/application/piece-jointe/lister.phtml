<?php

use Application\Provider\Privilege\Privileges;

/**
 * @var $this \Application\View\Renderer\PhpRenderer
 * @var $pj   \Application\Entity\Db\PieceJointe
 */

$fichiers = $pj ? $pj->getFichier() : []; /* @var $fichiers \Application\Entity\Db\Fichier[] */

?>

<?php if (!empty($fichiers)): ?>

<ul>
<?php foreach ($fichiers as $fichier): ?>
    <li class="fichier-pj">

        <!-- lien de téléchargement du fichier -->
        <?php
        $canEdit = $this->isAllowed($pj, Privileges::PIECE_JUSTIFICATIVE_EDITION);

        if ($canEdit) {
            $paramsTelecharger = ['fichier' => $fichier->getId(), 'nomFichier' => $fichier->getNom()];
            $urlTelecharger    = $this->url('piece-jointe/intervenant/fichier/telecharger', $paramsTelecharger, [], true);
            echo $this->uploader()->renderUploadedFile($fichier, $urlTelecharger);
        }

        if ($canEdit && !$pj->getValidation()) {
            $paramsSupprimer = ['pieceJointe' => $pj->getId(), 'fichier' => $fichier->getId()];
            $urlSupprimer    = $this->url('piece-jointe/intervenant/fichier/supprimer', $paramsSupprimer, [], true);
            echo $this->uploader()->renderDeleteFile($fichier, $urlSupprimer);
        }
        ?>
    </li>
<?php endforeach ?>
</ul>

<?php else: ?>

<p>Aucun.</p>

<?php endif ?>