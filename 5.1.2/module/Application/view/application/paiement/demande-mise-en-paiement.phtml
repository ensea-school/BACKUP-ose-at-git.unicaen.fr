<?php

/**
 * @var $this \Application\View\Renderer\PhpRenderer
 * @var $intervenant Application\Entity\Db\Intervenant
 * @var $serviceaAPayer Application\Entity\Db\ServiceAPayerInterface[]
 * @var $saved boolean
 * @var $dateDerniereModif DateTime
 * @var $dernierModificateur \Application\Entity\Db\Utilisateur
 * @var $changeIndex integer
 * @var $budget array
 * @var $whyNotEditable array
 */

$title = 'Demande de mise en paiement';
if ($intervenant){
    $title .= ' <small>'.$intervenant.'</small>';
    $this->headTitle()->append($intervenant->getNomUsuel())->append($title);
}else{
    $this->headTitle()->append($title);
}

$this->headTitle()->append($intervenant->getNomUsuel())->append($title) ?>

<h1 class="page-header"><?php echo $title; ?></h1>

<?php


if ($whyNotEditable){
    echo '<div class="alert alert-warning">'
        .'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        .'<strong>Attention</strong> : certaines demandes de mise en paiement ne peuvent pas être faites :'
        .'<ul>';
    foreach ($whyNotEditable as $ws){
        echo '<li>'.($ws['structure'] ? $ws['structure'] : 'Toutes composantes');
        echo '<ul>';
        foreach( $ws['raisons'] as $raison){
            echo "<li>$raison</li>";
        }
        echo '</ul></li>';
    }
    echo '</ul></div>';
}



echo $this->demandeMiseEnPaiement($servicesAPayer, $changeIndex)->setBudget($budget)->render();

echo $this->historique()->setHistoModification($dateDerniereModif)->setHistoModificateur($dernierModificateur);

if ($saved){
?>
<script type="text/javascript">
    $(function() {
        alertFlash('La demande de paiement a bien été prise en compte.', 'success', 2000);
    });
</script>
<?php
}