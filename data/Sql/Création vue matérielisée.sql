DROP MATERIALIZED view MV_INTERVENANT;
CREATE MATERIALIZED VIEW MV_INTERVENANT REFRESH NEXT SYSDATE + 1 AS



CREATE OR REPLACE TRIGGER CONTROLE_PLAFOND 
BEFORE INSERT OR UPDATE OF INTERVENANT_ID,HEURES,FONCTION_ID,ANNEE_ID ON SERVICE_REFERENTIEL 
BEGIN
--  RAISE EXCEPTION 'Coucou Bertrand!!';
  return new;
END;







SELECT
    AR.C_STRUCTURE                                Z_STRUCTURE_ID,
    AR.NO_DOSSIER_PERS                            Z_INTERVENANT_ID,
    ose_import.get_source_id('Harpege')           SOURCE_ID,
    MIN(to_char(AR.no_seq_affe_rech))             SOURCE_CODE,
    MIN(AR.D_DEB_AFFE_RECH)                       VALIDITE_DEBUT,
    MAX(AR.D_FIN_AFFE_RECH)                       VALIDITE_FIN
FROM
  affectation_recherche@harpprod ar
GROUP BY
  AR.C_STRUCTURE, AR.NO_DOSSIER_PERS;
