SELECT
 
-- Création de la séquence
'
CREATE SEQUENCE ' || SUBSTR(TABLE_NAME,0,23) || '_ID_SEQ INCREMENT BY 1 MAXVALUE 9999999999999999999999999999 MINVALUE 1 NOCACHE;
' ||
 
-- Création des champs
'
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( validite_debut DATE ) ;
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( validite_fin DATE ) ;
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( histo_creation DATE ) ;
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( histo_createur_id NUMBER (*,0) ) ;
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( histo_modification DATE ) ;
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( histo_modificateur_id NUMBER (*,0) ) ;
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( histo_destruction DATE ) ;
ALTER TABLE OSE.' || TABLE_NAME || ' ADD ( histo_destructeur_id NUMBER (*,0) ) ;
' ||
 
 
 
-- Affectation des valeurs si des champs ont déjà été créés
'
UPDATE OSE.' || TABLE_NAME || ' SET VALIDITE_DEBUT = SYSDATE WHERE VALIDITE_DEBUT IS NULL;
UPDATE OSE.' || TABLE_NAME || ' SET HISTO_CREATION = SYSDATE WHERE HISTO_CREATION IS NULL;
UPDATE OSE.' || TABLE_NAME || ' SET HISTO_CREATEUR_ID = 1 WHERE HISTO_CREATEUR_ID IS NULL;
UPDATE OSE.' || TABLE_NAME || ' SET HISTO_MODIFICATION = SYSDATE WHERE HISTO_MODIFICATION IS NULL;
UPDATE OSE.' || TABLE_NAME || ' SET HISTO_MODIFICATEUR_ID = 1 WHERE HISTO_MODIFICATEUR_ID IS NULL;
' ||
 
 
 
-- Application des contraintes NOT NULL
'
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY (VALIDITE_DEBUT NOT NULL);
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY (HISTO_CREATION NOT NULL);
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY (HISTO_CREATEUR_ID NOT NULL);
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY (HISTO_MODIFICATION NOT NULL);
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY (HISTO_MODIFICATEUR_ID NOT NULL);
' ||
 
 
 
-- Création des valeurs par défaut
'
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY(VALIDITE_DEBUT DEFAULT SYSDATE);
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY(HISTO_CREATION DEFAULT SYSDATE);
ALTER TABLE OSE.' || TABLE_NAME || ' MODIFY(HISTO_MODIFICATION DEFAULT SYSDATE);
' ||
 
 
 
-- Création des clés étrangères
'
ALTER TABLE OSE.' || TABLE_NAME || ' ADD CONSTRAINT ' || SUBSTR(TABLE_NAME,0,25) || '_HCFK FOREIGN KEY (HISTO_CREATEUR_ID)     REFERENCES OSE.UTILISATEUR(ID);
ALTER TABLE OSE.' || TABLE_NAME || ' ADD CONSTRAINT ' || SUBSTR(TABLE_NAME,0,25) || '_HMFK FOREIGN KEY (HISTO_MODIFICATEUR_ID) REFERENCES OSE.UTILISATEUR(ID);
ALTER TABLE OSE.' || TABLE_NAME || ' ADD CONSTRAINT ' || SUBSTR(TABLE_NAME,0,25) || '_HDFK FOREIGN KEY (HISTO_DESTRUCTEUR_ID)  REFERENCES OSE.UTILISATEUR(ID);
'
 
FROM
  USER_TABLES
WHERE
  TABLE_NAME IN (SELECT TABLE_NAME FROM USER_TAB_COLS WHERE COLUMN_NAME = 'HISTO_CREATION') 
ORDER BY
  TABLE_NAME;