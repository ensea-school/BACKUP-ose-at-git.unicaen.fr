CREATE OR REPLACE TRIGGER "T_CRG_ETAPE"
  AFTER INSERT OR DELETE OR UPDATE OF HISTO_DESTRUCTION ON "ETAPE"
  REFERENCING FOR EACH ROW
  BEGIN
  IF NOT UNICAEN_TBL.ACTIV_TRIGGERS THEN RETURN; END IF;

  IF DELETING THEN
    UNICAEN_TBL.DEMANDE_CALCUL( 'chargens', 'ETAPE_ID', :OLD.id );
    UNICAEN_TBL.DEMANDE_CALCUL( 'chargens', 'ETAPE_ENS_ID', :OLD.id );
  ELSE
    UNICAEN_TBL.DEMANDE_CALCUL( 'chargens', 'ETAPE_ID', :NEW.id );
    UNICAEN_TBL.DEMANDE_CALCUL( 'chargens', 'ETAPE_ENS_ID', :NEW.id );
  END IF;

END;