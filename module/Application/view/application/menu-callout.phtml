<?php

use UnicaenApp\View\Helper\TagViewHelper;

/**
 * @var $this      \Application\View\Renderer\PhpRenderer
 * @var $pages     array|\Framework\Navigation\Page[]
 */

$rubriques = [];


foreach ($pages as $page) {
    $rubrique = [
        'color'       => $page->getColor(),
        'description' => $page->getData('description'),
        'icon'        => $page->getIcon(),
        'html'        => $page->htmlify(),
        'items'       => [],
    ];

    $children = $page->getVisiblePages();
    foreach ($children as $child) {
        $rubrique['items'][] = $child->htmlify();
    }

    $rubriques[] = $rubrique;
}

echo $this->tag('div', ['class' => 'callout-menu']);
$i = 0;
foreach ($rubriques as $rubrique) {
    if (!empty($rubrique['items'])) {
        $attrs = [
            'class' => 'callout-container',
        ];
        if ($borderColor = $rubrique['color']) {
            $attrs['style'] = 'background-color:' . $borderColor;
        }
        if ($description = $rubrique['description']) {
            $attrs['title'] = $description;
        }

        if ($i % 2 != 1) {
            echo '<div style="clear: both"></div>';
        }

        echo $this->tag('div', $attrs);
        echo $this->tag('div', ['class' => 'callout']);
        if ($icon = $rubrique['icon']) {
            echo $this->tag('span', ['class' => $icon])->open(TagViewHelper::AUTOCLOSE_FULL);
        }
        echo $this->tag('h1')->html($rubrique['html']);
        echo '<ul>';
        foreach ($rubrique['items'] as $item) {
            echo $this->tag('li')->html($item);
        }
        echo '</ul>';
        echo '</div>';
        echo '</div>';
    }
    $i++;
}
echo '<div style="clear: both"></div>';
echo '</div>';