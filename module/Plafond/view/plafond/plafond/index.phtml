<?php

use Application\Provider\Privileges;

/**
 * @var $this                 \Application\View\Renderer\PhpRenderer
 * @var $title                string
 * @var $plafonds             \Plafond\Entity\Db\Plafond[]
 */

$canEdit = $this->isAllowed(Privileges::getResourceId(Privileges::PLAFONDS_EDITION));

?>
    <h1 class="page-header"><?= $title ?></h1>

    <table class="table table-sm table-hover table-bordered plafonds-config">
        <thead>
        <tr>
            <th rowspan="2">Périmètre</th>
            <th rowspan="2">Numéro</th>
            <th rowspan="2">Plafond</th>
            <?php if ($canEdit): ?>
                <th rowspan="2">Actions</th>
            <?php endif; ?>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($plafonds as $plafond): ?>
            <tr>
                <td><?= $plafond->getPlafondPerimetre() ?></td>
                <td><?= $plafond->getNumero() ?></td>
                <td style="width:50%"><?= $plafond; ?></td>
                <?php if ($canEdit): ?>
                    <td>
                        <a href="<?= $this->url('plafond/modifier', ['plafond' => $plafond->getId()]) ?>" title="Modifier le plafond"><i
                                    class="fas fa-pen-to-square"></i></a>
                        <a class="pop-ajax"
                           href="<?= $this->url('plafond/supprimer', ['plafond' => $plafond->getId()]) ?>"
                           title="Supprimer le plafond"
                           data-content="<p class='lead text-danger'><strong>Attention!</strong> Confirmez-vous cette suppression ?</p>"
                           data-confirm="true"
                           data-confirm-button="Oui"
                           data-cancel-button="Non"
                           data-submit-reload="true"
                        >
                            <i class="fas fa-trash-can"></i
                        </a>
                    </td>
                <?php endif; ?>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
<?php if ($canEdit): ?>
    <a href="<?= $this->url('plafond/ajouter') ?>" class="btn btn-secondary">Création d'un nouveau plafond</a>
<?php endif; ?>
    <a href="<?= $this->url('plafond/construire-calculer') ?>" class="btn btn-info pop-ajax">Construction & calcul de tous les plafonds</a>
<?= $this->plafondConfig()->script() ?>